\pgfplotsset{
    discard if not/.style 2 args={
        x filter/.code={
            \edef\tempa{\thisrow{#1}}
            \edef\tempb{#2}
            \ifx\tempa\tempb
            \else
                \def\pgfmathresult{inf}
            \fi
        }
    }
}

\newcommand{\ksweeperrplot}{
\addplot [ultra thick, green, discard if not={algo}{0}] table [x=k, y=relerr] {\datafile};
\addplot [ultra thick, red, discard if not={algo}{1}] table [x=k, y=relerr] {\datafile};
\addplot [ultra thick, blue, discard if not={algo}{2}] table [x=k, y=relerr] {\datafile};
\legend{MU, HALS, BPP}
}
\newcommand{\ksweeperroptions}{
xlabel={Low Rank ($k$)},
ylabel={Rel. Error}
}

\newcommand{\itererrplot}{
\addplot [ultra thick, green, discard if not={algo}{0}] table [x=iter, y=relerr] {\datafile};
\addplot [ultra thick, red, discard if not={algo}{1}] table [x=iter, y=relerr] {\datafile};
\addplot [ultra thick, blue, discard if not={algo}{2}] table [x=iter, y=relerr] {\datafile};
\legend{MU, HALS, BPP}
}
\newcommand{\itererroptions}{
xlabel={Iteration},
ylabel={Rel. Error}
}

\begin{figure}[htbp]
\begin{center}
\begin{tikzpicture}
\renewcommand{\datafile}{data/densesyn_ksweep.dat}
\begin{axis}[\ksweeperroptions]
%\ksweeperrplot
\end{axis}
\end{tikzpicture}
\caption{Dense Synthetic - ksweep}
\label{fig:densesynksweeperr}
\end{center}
\end{figure}

\begin{figure}[htbp]
\begin{center}
\begin{tikzpicture}
\renewcommand{\datafile}{data/sparsesyn_ksweep.dat}
\begin{axis}[\ksweeperroptions]
%\ksweeperrplot
\end{axis}
\end{tikzpicture}
\caption{Sparse Synthetic - ksweep}
\label{fig:sparsesynksweeperr}
\end{center}
\end{figure}

\begin{figure}[htbp]
\begin{center}
\begin{tikzpicture}
\renewcommand{\datafile}{data/densesyn_iter.dat}
\begin{axis}[\itererroptions]
%\itererrplot
\end{axis}
\end{tikzpicture}
\caption{Dense Synthetic - Iteration vs Rel.Err}
\label{fig:densesynitererr}
\end{center}
\end{figure}

\begin{figure}[htbp]
\begin{center}
\begin{tikzpicture}
\renewcommand{\datafile}{data/sparsesyn_iter.dat}
\begin{axis}[\itererroptions]
%\itererrplot
\end{axis}
\end{tikzpicture}
\caption{Sparse Synthetic - Iteration vs Rel.Err}
\label{fig:sparsesynitererr}
\end{center}
\end{figure}
